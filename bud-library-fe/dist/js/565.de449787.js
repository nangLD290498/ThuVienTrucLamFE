"use strict";(self["webpackChunkbuddhist_library_fe"]=self["webpackChunkbuddhist_library_fe"]||[]).push([[565],{565:function(e,t,o){o.r(t),o.d(t,{default:function(){return ge}});var s=o(3396),r=o(7139),a=o(9242);const n=e=>((0,s.dD)("data-v-b9487754"),e=e(),(0,s.Cn)(),e),l={key:0,class:"section"},i={class:"section-header"},h={key:0,class:"section-title mt-0"},c={key:1,class:"section-title mt-0"},d={class:"section-body"},u={class:"row"},m={class:"col-12"},b={class:"card"},p={class:"card-body"},g={class:"row"},k={key:0,class:"col-12"},y={class:"mb-3"},f=n((()=>(0,s._)("label",{for:"exampleFormControlTextarea1",class:"form-label p-0 m-0"},"File PDF",-1))),C={key:0,class:"form-text text-danger"},v={key:1,class:"col-12"},_={class:"mb-3"},x=n((()=>(0,s._)("label",{for:"exampleFormControlTextarea1",class:"form-label p-0 m-0"},"Ảnh bìa",-1))),w={key:0,class:"form-text text-danger"},T={class:"col-12"},F={class:"mb-3"},D=n((()=>(0,s._)("label",{for:"exampleFormControlTextarea1",class:"form-label p-0 m-0"},"Thể loại",-1))),P={key:0,class:"form-text text-danger"},A={class:"col-12"},U={class:"mb-3"},$=n((()=>(0,s._)("label",{for:"exampleFormControlTextarea1",class:"form-label p-0 m-0"},"Tên sách",-1))),I={key:0,class:"form-text text-danger"},V={class:"col-12"},q={class:"mb-3"},S=n((()=>(0,s._)("label",{for:"exampleFormControlTextarea1",class:"form-label p-0 m-0"},"Tác giả",-1))),E={key:0,class:"form-text text-danger"},M={class:"col-12"},B={class:"mb-3"},L=n((()=>(0,s._)("label",{for:"exampleFormControlTextarea1",class:"form-label p-0 m-0"},"Nhà xuất bản",-1))),z={key:0,class:"form-text text-danger"},N={class:"col-12"},O={class:"mb-3"},Y=n((()=>(0,s._)("label",{for:"exampleFormControlTextarea1",class:"form-label p-0 m-0"},"Năm xuất bản",-1))),H={key:0,class:"form-text text-danger"},j={class:"col-12"},G={class:"mb-3"},Z={class:"mt-1"},K={class:"d-flex"},R=n((()=>(0,s._)("div",{style:{width:"100%"}},"Mục lục",-1))),W={key:0,class:"form-text text-danger"},J=["disabled"],Q={class:"spinner-border spinner-border-sm"};function X(e,t,o,n,X,ee){const te=(0,s.up)("AutoComplete"),oe=(0,s.up)("TreeNode");return X.book?((0,s.wg)(),(0,s.iD)("section",l,[(0,s._)("div",i,["create"==X.mode?((0,s.wg)(),(0,s.iD)("div",h,"Thêm sách")):((0,s.wg)(),(0,s.iD)("div",c,"Chỉnh sửa sách"))]),(0,s._)("div",d,[(0,s._)("div",u,[(0,s._)("div",m,[(0,s._)("div",b,[(0,s._)("div",p,[(0,s._)("div",g,["create"==X.mode?((0,s.wg)(),(0,s.iD)("div",k,[(0,s._)("div",y,[f,(0,s._)("input",{type:"file",class:"form-control",onChange:t[0]||(t[0]=(...e)=>ee.onFileUploadPdf&&ee.onFileUploadPdf(...e))},null,32),X.error.books?((0,s.wg)(),(0,s.iD)("div",C,(0,r.zw)(X.error.books[0]),1)):(0,s.kq)("",!0)])])):(0,s.kq)("",!0),"create"==X.mode?((0,s.wg)(),(0,s.iD)("div",v,[(0,s._)("div",_,[x,(0,s._)("input",{type:"file",class:"form-control",onChange:t[1]||(t[1]=(...e)=>ee.onFileUploadThumb&&ee.onFileUploadThumb(...e))},null,32),X.error.books?((0,s.wg)(),(0,s.iD)("div",w,(0,r.zw)(X.error.books[0]),1)):(0,s.kq)("",!0)])])):(0,s.kq)("",!0),(0,s._)("div",T,[(0,s._)("div",F,[D,(0,s.Wm)(te,{Vmodel:X.category,list:e.categories.map((e=>e.name)),onGetTextContent:ee.getCateContent},null,8,["Vmodel","list","onGetTextContent"]),X.error.books?((0,s.wg)(),(0,s.iD)("div",P,(0,r.zw)(X.error.books[0]),1)):(0,s.kq)("",!0)])]),(0,s._)("div",A,[(0,s._)("div",U,[$,(0,s.wy)((0,s._)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>X.book.name=e),class:"form-control"},null,512),[[a.nr,X.book.name]]),X.error.books?((0,s.wg)(),(0,s.iD)("div",I,(0,r.zw)(X.error.books[0]),1)):(0,s.kq)("",!0)])]),(0,s._)("div",V,[(0,s._)("div",q,[S,(0,s.Wm)(te,{Vmodel:X.book.author,list:X.authors,onGetTextContent:ee.getAuthorContent},null,8,["Vmodel","list","onGetTextContent"]),X.error.books?((0,s.wg)(),(0,s.iD)("div",E,(0,r.zw)(X.error.books[0]),1)):(0,s.kq)("",!0)])]),(0,s._)("div",M,[(0,s._)("div",B,[L,(0,s.Wm)(te,{Vmodel:X.book.publisher,list:X.publishers,onGetTextContent:ee.getPublisherContent},null,8,["Vmodel","list","onGetTextContent"]),X.error.books?((0,s.wg)(),(0,s.iD)("div",z,(0,r.zw)(X.error.books[0]),1)):(0,s.kq)("",!0)])]),(0,s._)("div",N,[(0,s._)("div",O,[Y,(0,s.wy)((0,s._)("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>X.book.publishedYear=e),class:"form-control"},null,512),[[a.nr,X.book.publishedYear]]),X.error.books?((0,s.wg)(),(0,s.iD)("div",H,(0,r.zw)(X.error.books[0]),1)):(0,s.kq)("",!0)])]),(0,s._)("div",j,[(0,s._)("div",G,[(0,s._)("div",Z,[(0,s._)("div",K,[R,(0,s._)("div",{class:"btn btn-outline-success ml-2",onClick:t[4]||(t[4]=e=>ee.addChild())},"+")])]),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(X.book.tableContent,(e=>((0,s.wg)(),(0,s.j4)(oe,{key:e.id,node:e,spacing:0},null,8,["node"])))),128)),X.error.books?((0,s.wg)(),(0,s.iD)("div",W,(0,r.zw)(X.error.books[0]),1)):(0,s.kq)("",!0)]),(0,s._)("button",{type:"submit",class:"btn btn-primary",onClick:t[5]||(t[5]=e=>ee.excute()),disabled:X.loading},[(0,s.wy)((0,s._)("span",Q,null,512),[[a.F8,X.loading]]),(0,s.Uk)("   "),(0,s._)("span",null,(0,r.zw)("create"===X.mode?"Thêm sách":"lưu thay đổi"),1)],8,J)])])])])])])])])):(0,s.kq)("",!0)}o(2801),o(7658);var ee=o(5580);const te={class:"d-flex"},oe={key:0};function se(e,t,o,n,l,i){const h=(0,s.up)("TreeNode",!0);return(0,s.wg)(),(0,s.iD)("div",{style:(0,r.j5)(i.nodeMargin),class:"mt-1"},[(0,s._)("div",te,[(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.node.headerContent=e),class:"form-control"},null,512),[[a.nr,o.node.headerContent]]),(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.node.fromPage=e),min:"1",class:"form-control",type:"number",placeholder:"từ trang",style:{width:"100px"}},null,512),[[a.nr,o.node.fromPage]]),(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.node.toPage=e),min:"1",class:"form-control",type:"number",placeholder:"đến trang",style:{width:"100px"}},null,512),[[a.nr,o.node.toPage]]),(0,s._)("div",{class:"btn btn-outline-success ml-2 my-1",onClick:t[3]||(t[3]=e=>i.addChild())},"+")]),i.hasChildren?((0,s.wg)(),(0,s.iD)("div",oe,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(o.node.childs,(e=>((0,s.wg)(),(0,s.j4)(h,{key:e.id,node:e,spacing:o.spacing+20},null,8,["node","spacing"])))),128))])):(0,s.kq)("",!0)],4)}var re={name:"TreeNode",props:{node:{type:Object,required:!0},spacing:{type:Number,default:0}},computed:{nodeMargin(){return{"margin-left":"40px"}},hasChildren(){const{childs:e}=this.node;return e&&e.length>0}},methods:{addChild(){this.node.childs.push({headerContent:"",childs:[]})}}},ae=o(89);const ne=(0,ae.Z)(re,[["render",se]]);var le=ne,ie=o(65);const he=["onClick"];function ce(e,t,o,n,l,i){return(0,s.wg)(),(0,s.iD)("div",null,[(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>l.searchTerm=e),type:"text",class:"form-control",onFocus:t[1]||(t[1]=(...e)=>i.authorForcus&&i.authorForcus(...e)),onFocusout:t[2]||(t[2]=(...e)=>i.authorForcusout&&i.authorForcusout(...e))},null,544),[[a.nr,l.searchTerm]]),i.searchAuthors.length&&l.isShowAuthor?((0,s.wg)(),(0,s.iD)("ul",{key:0,onMouseover:t[3]||(t[3]=e=>l.isMouseOnAuthor=!0),onMouseleave:t[4]||(t[4]=e=>l.isMouseOnAuthor=!1),class:"mb-3 author-list"},[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(i.searchAuthors,(e=>((0,s.wg)(),(0,s.iD)("li",{key:e,onClick:t=>i.selectAuthor(e)},(0,r.zw)(e),9,he)))),128))],32)):(0,s.kq)("",!0)])}var de={data(){return{searchTerm:"",selectedAuthor:"",isShowAuthor:!1,isMouseOnAuthor:!1}},props:{list:{type:Object,default:[]},Vmodel:{type:Object,default:""}},watch:{searchTerm:function(){this.$emit("getTextContent",this.searchTerm)}},created(){this.searchTerm=this.Vmodel},computed:{searchAuthors:function(){if(""===this.searchTerm)return this.list;let e=0;return this.list.filter((t=>{if(t.toLowerCase().includes(this.searchTerm.toLowerCase())&&e<10)return e++,t}))}},methods:{authorForcusout(){this.isMouseOnAuthor||(this.isShowAuthor=!1)},authorForcus(){this.isShowAuthor=!0},selectAuthor(e){this.selectedAuthor=e,this.searchTerm=e,this.isShowAuthor=!1}}};const ue=(0,ae.Z)(de,[["render",ce]]);var me=ue,be={data(){return{book:null,bookDefalt:{name:"",author:"",publisher:"",publishedYear:2015,tableContent:[{headerContent:"",childs:[]}]},mode:ee.ZP.CREATE,error:{},PDF_FILE:null,THUMB_FILE:null,category:"",isSaved:"",authors:[],publishers:[],loading:!1}},components:{TreeNode:le,AutoComplete:me},beforeDestroy(){},created(){this.getData(),this.$route.params.id?(this.$store.dispatch("Book/findById",this.$route.params.id).then((e=>{let t=e.data.content.book;this.book=t})),this.mode=ee.ZP.UPDATE,this.category=this.$route.params.cate):this.book=this.bookDefalt,this.$store.dispatch("Author/get",{page:-1}).then((e=>{this.authors=e.data.content,this.authors=this.authors.map((e=>e.author))})),this.$store.dispatch("Publisher/get",{page:-1}).then((e=>{this.publishers=e.data.content,this.publishers=this.publishers.map((e=>e.publisher))}))},computed:{...(0,ie.rn)("Category",["categories"])},methods:{getPublisherContent(e){this.book.publisher=e},getAuthorContent(e){this.book.author=e},getCateContent(e){this.category=e},getData(){this.$store.dispatch("Category/get")},async excute(){this.loading=!0;let e=this,t=localStorage.getItem("user");if(""!==this.book.name.trim()&&""!==this.book.author.trim()&&""!==this.book.publisher.trim()&&null!=this.category&&""!==this.category.trim()&&null!=this.PDF_FILE&&this.isContenTableValid(this.book.tableContent[0])||"create"!==this.mode)if(""!==this.book.name.trim()&&""!==this.book.author.trim()&&""!==this.book.publisher.trim()&&null!=this.category&&""!==this.category.trim()&&this.isContenTableValid(this.book.tableContent[0])||"update"!==this.mode)try{let o=null;o="create"===this.mode?{name:this.book.name,author:this.book.author,publisher:this.book.publisher,publishedYear:this.book.publishedYear.toString(),remarks:"",category:{name:this.category,remarks:""}}:{id:this.book.id,name:this.book.name,author:this.book.author,publisher:this.book.publisher,publishedYear:this.book.publishedYear.toString(),remarks:"",category:{name:this.category,remarks:""}};let s=this.book.tableContent;console.log("bookInfo",o),console.log("tableContents",this.book.tableContent);const r=new FormData;"create"===this.mode&&(r.append("file",this.PDF_FILE,this.PDF_FILE.name),r.append("thumbnailPic",this.THUMB_FILE,this.THUMB_FILE.name)),r.append("bookString",btoa(unescape(encodeURIComponent(JSON.stringify(o))))),r.append("tableContent",btoa(unescape(encodeURIComponent(JSON.stringify(s))))),await this.$store.dispatch("Book/"+this.mode,{token:t,formData:r}).then((t=>{this.status=t.data.status,console.log("status: ",t.data.status),"NOK"!==t.data.status?("create"===this.mode?e.$notify({type:"success",text:"Thêm sách thành công!"}):e.$notify({type:"success",text:"Chỉnh sửa sách thành công!"}),e.$router.push({name:"admin.books"})):e.$notify({type:"error",text:t.data.message})}),(t=>{if(this.loading=!1,401===t.request.status)return alert("Bạn đã hết phiên đăng nhập, hãy đăng nhập lại để tiếp tục !"),console.log("loggin out"),localStorage.removeItem("user"),localStorage.removeItem("username"),void e.$router.go("/login");t.response&&t.response.data.error?e.error=t.response.data.error:e.$notify({type:"error",text:"Hãy kiểm tra lại thông tin sách !"})})),this.$store.dispatch("Book/deleteTC",t).then((e=>{}),(e=>{})),this.loading=!1}catch(o){this.loading=!1,console.log("Error: ",o),e.$notify({type:"error",text:"Bạn cần nhập thông tin đầy đủ và chính xác !"})}else e.$notify({type:"error",text:"Bạn cần nhập thông tin đầy đủ và chính xác !"});else e.$notify({type:"error",text:"Bạn cần nhập thông tin đầy đủ và chính xác !"})},onFileUploadPdf(e){this.PDF_FILE=e.target.files[0]},onFileUploadThumb(e){this.THUMB_FILE=e.target.files[0]},addChild(){console.log("Daata: ",this.book),this.book.tableContent.push({headerContent:"",childs:[]})},isContenTableValid(e){return""!==e.headerContent&&void 0!=e.fromPage&&void 0!=e.toPage&&""!=e.fromPage&&""!=e.toPage}}};const pe=(0,ae.Z)(be,[["render",X],["__scopeId","data-v-b9487754"]]);var ge=pe}}]);
//# sourceMappingURL=565.de449787.js.map