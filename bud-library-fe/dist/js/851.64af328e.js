"use strict";(self["webpackChunkbuddhist_library_fe"]=self["webpackChunkbuddhist_library_fe"]||[]).push([[851],{5325:function(e,t,n){n.d(t,{Z:function(){return g}});var o=n(3396),s=n(7139);const a=(0,o.uE)('<span class="rot-1" data-v-571b8f05></span><span class="rot-2" data-v-571b8f05></span><span class="rot-3" data-v-571b8f05></span><span class="rot-4" data-v-571b8f05></span><span class="rot-5" data-v-571b8f05></span><span class="rot-6" data-v-571b8f05></span><span class="rot-7" data-v-571b8f05></span><span class="rot-8" data-v-571b8f05></span>',8),i=[a];function r(e,t,n,a,r,l){return(0,o.wg)(),(0,o.iD)("div",{class:"preloader",style:(0,s.j5)(l.cssVars)},i,4)}var l={name:"Preloader",props:{color:{type:String,default:"#41b883"},scale:{type:Number,default:1}},computed:{cssVars(){return{"--color":this.color,"--scale":this.scale}}}},d=n(89);const c=(0,d.Z)(l,[["render",r],["__scopeId","data-v-571b8f05"]]);var g=c},5851:function(e,t,n){n.r(t),n.d(t,{default:function(){return De}});var o=n(3396),s=n(7139),a=n(9242);const i=e=>((0,o.dD)("data-v-38aa20d9"),e=e(),(0,o.Cn)(),e),r={class:"content"},l={ref:"col12",class:"col-12"},d={class:"card card-warning",style:{"max-width":"2200px",margin:"auto"}},c={class:"card-body px-0"},g={class:"row text-center"},h={class:"col-1 px-0"},p=i((()=>(0,o._)("i",{class:"fas fa-angle-left"},null,-1))),u=[p],f={class:"page-content"},m={class:"page-content"},b={class:"col-1 px-0"},w=i((()=>(0,o._)("i",{class:"fas fa-angle-right"},null,-1))),y=[w],v={class:"speech-bubble"},C={class:"share-inside"},_=i((()=>(0,o._)("b",null,"Chi tiết",-1))),k=[_],P={ref:"reference",class:"modal fade",tabindex:"-1",id:"fire-modal-confirm","aria-modal":"true",role:"dialog"},x={class:"modal-dialog modal-md modal-dialog-centered",role:"document"},S={class:"modal-content bg-copy-x"},T=i((()=>(0,o._)("div",{class:"modal-header pt-3",style:{"border-bottom":"solid 1px #dbdbdb"}},[(0,o._)("h5",{class:"modal-title"},"Trích dẫn")],-1))),L={class:"modal-body",style:{"border-bottom":"solid 1px #dbdbdb"}},z={class:"main-color"},D=i((()=>(0,o._)("hr",null,null,-1))),R={class:"row"},I=i((()=>(0,o._)("div",{class:"col-4 font-weight-bold"},"Tác giả/Dịch giả",-1))),H={class:"col-8 main-color"},M={class:"row"},E=i((()=>(0,o._)("div",{class:"col-4 font-weight-bold"},"Tên sách",-1))),B={class:"col-8 main-color"},A={class:"row"},Y=i((()=>(0,o._)("div",{class:"col-4 font-weight-bold"},"Mục lục",-1))),q={class:"col-8"},U={class:"main-color"},N=i((()=>(0,o._)("br",null,null,-1))),j={class:"row"},O=i((()=>(0,o._)("div",{class:"col-4 font-weight-bold"},"Nhà xuất bản",-1))),X={class:"col-8 main-color"},F={class:"row"},Z=i((()=>(0,o._)("div",{class:"col-4 font-weight-bold"},"Năm xuất bản",-1))),K={class:"col-8 main-color"},V={class:"row"},W=i((()=>(0,o._)("div",{class:"col-4 font-weight-bold"},"Trang",-1))),G={class:"col-8 main-color"},Q={class:"main-color"},J={class:"modal-footer",style:{padding:"10px 10px 10px 0px"}},ee={key:1,class:"app-header"},te={class:"page-setting"},ne={id:"menu"},oe={class:"parent"},se={class:"menu-display"},ae=["max","value"],ie={class:"zoom"},re=i((()=>(0,o._)("span",{class:"close-sign"},"X",-1))),le=i((()=>(0,o._)("span",{class:"close-sign"},"X",-1))),de={key:2,class:"side-bar"};function ce(e,t,n,i,p,w){const _=(0,o.up)("vue-pdf-embed"),$=(0,o.up)("Loader"),ce=(0,o.up)("router-link"),ge=(0,o.up)("TreeNodeforReadPage"),he=(0,o.Q2)("dragscroll");return(0,o.wg)(),(0,o.iD)(o.HY,null,[p.book?((0,o.wg)(),(0,o.iD)("section",{key:0,class:"section",onClick:t[11]||(t[11]=(...e)=>w.clearPopup&&w.clearPopup(...e))},[(0,o._)("div",r,[(0,o._)("div",l,[(0,o._)("div",d,[(0,o._)("div",c,[(0,o._)("div",g,[(0,o._)("div",h,[(0,o._)("a",{href:"#",class:(0,s.C_)("btn btn-icon btn-info "+(1!=p.pageLeft&&p.isDoneLoading2?"":" disabled")),style:{margin:"0",position:"absolute",top:"50%","-ms-transform":"translateY(-50%)",transform:"translateX(-50%)","border-radius":"28px"},onClick:t[0]||(t[0]=e=>w.prevPage())},u,2)]),(0,o._)("div",{onContextmenu:t[2]||(t[2]=(0,a.iM)((e=>w.handlerFunction(e)),["right"])),onClick:t[3]||(t[3]=(...e)=>w.clearPopup&&w.clearPopup(...e)),class:"col-5 pl-0"},[(0,o._)("div",f,[(0,o.Wm)(_,{style:{"box-shadow":"rgb(136, 136, 136) 5px 5px 5px 5px"},onClick:t[1]||(t[1]=e=>w.selectOnPage("LEFT")),source:p.pdfSource,page:p.pageLeft,onRendered:w.handleDocumentRender,onPasswordRequested:w.handlePasswordRequest},null,8,["source","page","onRendered","onPasswordRequested"])])],32),(0,o._)("div",{onContextmenu:t[5]||(t[5]=(0,a.iM)((e=>w.handlerFunction(e)),["right"])),onClick:t[6]||(t[6]=(...e)=>w.clearPopup&&w.clearPopup(...e)),class:"col-5 mx-0 pr-0"},[(0,o.wy)(((0,o.wg)(),(0,o.iD)("div",m,[(0,o.Wm)(_,{style:{"box-shadow":"rgb(136, 136, 136) 5px 5px 5px 5px"},onClick:t[4]||(t[4]=e=>w.selectOnPage("RIGHT")),ref:"pdfRef",source:p.pdfSource,page:p.pageRight},null,8,["source","page"])])),[[he,!0]])],32),(0,o._)("div",b,[(0,o._)("a",{href:"#",class:(0,s.C_)("btn btn-icon btn-info"+(!p.isDoneLoading2||p.isLastPage?" disabled":"")),style:{"border-radius":"28px",top:"50%",position:"absolute",transform:"translateX(-50%)"},onClick:t[7]||(t[7]=e=>w.nextPage())},y,2)])])])])],512),(0,o._)("div",{class:(0,s.C_)(["loader-background",{"done-loading":p.isDoneLoading}])},[(0,o.Wm)($,{class:"loader"})],2)]),p.hasSelectedString?((0,o.wg)(),(0,o.iD)("div",{key:0,style:(0,s.j5)("background: rgb(253 147 0); z-index: 1; position: absolute; top: "+p.posY+"px; left: "+p.posX+"px;")},[(0,o._)("div",v,[(0,o._)("div",C,[(0,o._)("a",{href:"javascript:void(0);",onClick:t[8]||(t[8]=e=>w.showPopup())},k)])])],4)):(0,o.kq)("",!0),(0,o._)("button",{class:"d-none btn btn-primary btn-info mx-2 trigger--fire-modal-confirm","data-toggle":"modal","data-target":"#fire-modal-confirm",id:"fire-modal",onClick:t[9]||(t[9]=e=>w.clickModal())},"Delete all"),(0,o._)("div",P,[(0,o._)("div",x,[(0,o._)("div",S,[T,(0,o._)("div",L,[(0,o._)("span",z,' "'+(0,s.zw)(this.selectedString)+'" ',1),D,(0,o._)("div",R,[I,(0,o._)("div",H,(0,s.zw)(p.book.author),1)]),(0,o._)("div",M,[E,(0,o._)("div",B,(0,s.zw)(p.book.name),1)]),(0,o._)("div",A,[Y,(0,o._)("div",q,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(p.selectedStringMenuParents,(e=>((0,o.wg)(),(0,o.iD)(o.HY,{key:e},[(0,o._)("span",U,(0,s.zw)(e),1),(0,o.Uk)(),N],64)))),128))])]),(0,o._)("div",j,[O,(0,o._)("div",X,(0,s.zw)(p.book.publisher),1)]),(0,o._)("div",F,[Z,(0,o._)("div",K,(0,s.zw)(p.book.publishedYear),1)]),(0,o._)("div",V,[W,(0,o._)("div",G,[(0,o._)("span",Q,(0,s.zw)("LEFT"==this.pagePosition?this.pageLeft:this.pageRight),1)])])]),(0,o._)("div",J,[(0,o._)("button",{type:"button",onClick:t[10]||(t[10]=e=>w.doExtractInfo()),ref:"copyBtn",class:"btn btn-primary copy-btn"}," Sao chép ",512)])])])],512)])):(0,o.kq)("",!0),p.book?((0,o.wg)(),(0,o.iD)("div",ee,[p.isDoneLoading?((0,o.wg)(),(0,o.iD)(o.HY,{key:1},[(0,o._)("span",te,[(0,o._)("div",{onClick:t[12]||(t[12]=(...e)=>w.displaySideBar&&w.displaySideBar(...e))},[(0,o._)("ul",ne,[(0,o._)("li",oe,[(0,o._)("div",se,[(0,o._)("span",null,(0,s.zw)(p.currentTableContent),1)])])])]),(0,o.Uk)("    "),(0,o._)("input",{onKeyup:t[13]||(t[13]=(0,a.D2)((e=>w.handlePageChange()),["enter"])),ref:"selectPageInput",type:"number",min:"1",max:p.pageCount,value:p.pageLeft,onFocusout:t[14]||(t[14]=e=>w.handlePageChange())},null,40,ae),(0,o.Uk)("  Trang "+(0,s.zw)(p.pageLeft)+" - "+(0,s.zw)(p.pageRight)+" / "+(0,s.zw)(p.pageCount),1)]),(0,o.Uk)("    "),(0,o._)("span",ie,[(0,o._)("i",{onClick:t[15]||(t[15]=(...e)=>w.zoomOut&&w.zoomOut(...e)),ref:"zout",class:"fa fa-search-minus",style:{"font-size":"15px",color:"white",cursor:"pointer"}},null,512),(0,o.Uk)("   "),(0,o._)("i",{onClick:t[16]||(t[16]=(...e)=>w.zoomIn&&w.zoomIn(...e)),ref:"zin",class:"fa fa-search-plus",style:{"font-size":"15px",color:"white",cursor:"pointer"}},null,512)]),1==e.$route.params.index?((0,o.wg)(),(0,o.j4)(ce,{key:0,to:{name:"books.read",params:{id:e.$route.params.id}}},{default:(0,o.w5)((()=>[re])),_:1},8,["to"])):(0,o.kq)("",!0),2==e.$route.params.index?((0,o.wg)(),(0,o.j4)(ce,{key:1,to:"/"},{default:(0,o.w5)((()=>[le])),_:1})):(0,o.kq)("",!0)],64)):((0,o.wg)(),(0,o.iD)(o.HY,{key:0},[(0,o.Uk)(" Loading... ")],64))])):(0,o.kq)("",!0),p.book&&p.showSideBar?((0,o.wg)(),(0,o.iD)("div",de,[(0,o._)("span",{class:"side-bar-x",onClick:t[17]||(t[17]=(...e)=>w.clearSideBar&&w.clearSideBar(...e))},"X"),((0,o.wg)(),(0,o.iD)("div",{class:"side-bar-content",key:p.currentTableContentArray},[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(p.book.tableContents,(e=>((0,o.wg)(),(0,o.j4)(ge,{key:e.id,node:e,spacing:0,index:0,currentTableContentArray:p.currentTableContentArray,onChangePageToHeader:w.changePageToHeader},null,8,["node","currentTableContentArray","onChangePageToHeader"])))),128))]))])):(0,o.kq)("",!0)],64)}n(7658);const ge={key:0};function he(e,t,n,a,i,r){const l=(0,o.up)("TreeNode");return(0,o.wg)(),(0,o.iD)("div",{style:(0,s.j5)(r.nodeMargin),class:"mt-1"},[(0,o._)("div",{class:(0,s.C_)("d-flex "+(i.isCurrent?"current-item":""))},[(0,o._)("div",{class:"table-content-item",style:(0,s.j5)(r.contentItem),onClick:t[0]||(t[0]=t=>e.$emit("changePageToHeader",n.node.fromPage))},[(0,o.Uk)("   "),(0,o._)("a",{href:"#",class:(0,s.C_)(i.isCurrent?"current":"")},(0,s.zw)(n.node.headerContent),3)],4)],2),r.hasChildren?((0,o.wg)(),(0,o.iD)("div",ge,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.node.childs,(s=>((0,o.wg)(),(0,o.j4)(l,{key:s.id,node:s,spacing:n.spacing+20,index:n.index+1,currentTableContentArray:n.currentTableContentArray,onChangePageToHeader:t[1]||(t[1]=t=>e.$emit("changePageToHeader",t))},null,8,["node","spacing","index","currentTableContentArray"])))),128))])):(0,o.kq)("",!0)],4)}var pe={name:"TreeNode",props:{node:{type:Object,required:!0},spacing:{type:Number,default:0},index:{type:Number,default:0},currentTableContentArray:{type:Array,default:[]}},data(){return{isCurrent:!1}},computed:{nodeMargin(){return{"margin-left":0==this.index?"10px":"40px"}},contentItem(){return{"font-weight":900-200*this.index}},hasChildren(){const{childs:e}=this.node;return e&&e.length>0}},mounted(){this.currentTableContentArray.forEach((e=>{e.fromPage==this.node.fromPage&&e.toPage==this.node.toPage&&e.headerContent==this.node.headerContent&&(this.isCurrent=!0)}))},methods:{addChild(){this.node.childs.push({headerContent:"",childs:[]})}}},ue=n(89);const fe=(0,ue.Z)(pe,[["render",he],["__scopeId","data-v-44315f90"]]);var me=fe,be=n(5325);const we={key:0,class:"child"},ye=["onClick"],ve={key:0,class:"expand"};function Ce(e,t,n,a,i,r){const l=(0,o.up)("NestedDropdown",!0);return n.contentTables.length>0?((0,o.wg)(),(0,o.iD)("ul",we,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.contentTables,(n=>((0,o.wg)(),(0,o.iD)("li",{key:n,class:"parent"},[(0,o._)("div",{class:"div",onMouseleave:t[0]||(t[0]=(...e)=>r.mouseMoveEvent&&r.mouseMoveEvent(...e))},[(0,o._)("div",{onClick:t=>e.$emit("changePageToHeader",n.fromPage)},[(0,o.Uk)((0,s.zw)(n.headerContent)+" ",1),n.childs&&n.childs.length>0?((0,o.wg)(),(0,o.iD)("span",ve,"»")):(0,o.kq)("",!0)],8,ye)],32),n.childs&&n.childs.length>0?((0,o.wg)(),(0,o.j4)(l,{onMouseenter:r.mouseOverHandle,style:(0,s.j5)((i.isUpperHalf?"top":"bottom")+": 0;  max-height: 300px;"),onChangePageToHeader:t[1]||(t[1]=t=>e.$emit("changePageToHeader",t)),page:n.fromPage,contentTables:n.childs,key:""},null,8,["onMouseenter","style","page","contentTables"])):(0,o.kq)("",!0)])))),128))])):(0,o.kq)("",!0)}var _e={props:{contentTables:{type:Object,default:[]}},data(){return{isUpperHalf:!0,middlehalf:0,clientY:0,nestedElement:null}},methods:{mouseOverHandle(e){this.nestedElement=e.target},mouseMoveEvent(e){this.middlehalf=window.innerHeight/2,e.clientY>=this.middlehalf?this.isUpperHalf=!1:this.isUpperHalf=!0}}};const ke=(0,ue.Z)(_e,[["render",Ce]]);var Pe=ke,xe=n(3627),Se=n.n(xe),Te=n(1073),Le={name:"ViewBook",components:{TreeNodeforReadPage:me,VuePdfEmbed:Se(),Loader:be.Z,NestedDropdown:Pe},data(){return{zoomIndex:1,pdfSource:null,pageLeft:1,pageRight:2,posX:0,posY:0,selectedString:"",hasSelectedString:!1,book:null,tableContentsArr:[],selectedStringMenu:"",selectedStringMenuParents:[],pagePosition:"",config:Te.Z,isDoneLoading:!1,isDoneLoading2:!1,pageCount:0,isLastPage:!1,currentTableContent:"",currentTableContentArray:[],showSideBar:!1}},created(){this.$route.params.id&&this.$store.dispatch("Book/findById",this.$route.params.id).then((e=>{let t=e.data.content.book;this.pageCount=e.data.content.pageCount,this.book=t,this.book.tableContents=t.tableContent,this.pdfSource=this.config.VUE_APP_BASE_URL+`/books/${this.$route.params.id}/pdf`;let n=this.book.tableContents;n.forEach((e=>{this.getChilds(e,null,[])}))}))},computed:{},mounted(){try{let e=parseInt(this.$route.params.startPage);console.log("initPage",e,this.pageCount),e%2==1?(this.isDoneLoading2=!1,this.pageLeft=e,this.pageRight=e+1):(this.initPage=!1,this.pageRight=e,this.pageLeft=e-1)}catch(e){this.$notify({type:"error",text:"Trang không hợp lệ !"})}},methods:{displaySideBar(){this.showSideBar=!this.showSideBar},clearSideBar(){this.showSideBar=!1},zoomOut(){let e=this.$refs.col12;if(this.zoomIndex>=.5){this.zoomIndex=this.zoomIndex-.1,console.log("zoomOut ",this.zoomIndex),e.style.zoom=this.zoomIndex;let t=this.$refs.zin;t.style.color="white"}else{let e=this.$refs.zout;e.style.color="grey"}},zoomIn(){let e=this.$refs.col12;if(this.zoomIndex<=1.5){this.zoomIndex=this.zoomIndex+.1,console.log("zoomIn ",this.zoomIndex),e.style.zoom=this.zoomIndex;let t=this.$refs.zout;t.style.color="white"}else{let e=this.$refs.zin;e.style.color="grey"}},changePageToHeader(e){e%2==1?(this.isDoneLoading2=!1,this.pageLeft=e,this.pageRight=e+1):(this.isDoneLoading2=!1,this.pageRight=e,this.pageLeft=e-1),this.$notify({type:"success",text:"Chuyển mục lục thành công"})},handlePageChange(){let e=parseInt(this.$refs.selectPageInput.value);isNaN(e)||void 0==e||null==e||e<1||e>this.pageCount?this.$notify({type:"error",text:"Trang không hợp lệ !"}):e!==this.pageLeft&&e!==this.pageRight?(e%2==1?(this.isDoneLoading2=!1,this.pageLeft=e,this.pageRight=e+1):(this.isDoneLoading2=!1,this.pageRight=e,this.pageLeft=e-1),this.$notify({type:"success",text:"Chuyển trang thành công"})):this.$notify({type:"warning",text:"Bạn hiện đang ở trang "+this.pageLeft+" "+this.pageRight+" !"})},getChilds(e,t,n){"undefined"===typeof e.parent&&(e.parent=t),this.tableContentsArr.push({headerContent:e.headerContent,fromPage:e.fromPage,toPage:e.toPage,parent:e.parent}),e.childs.length>0&&e.childs.forEach((t=>{this.getChilds(t,e,n)}))},getParents(e){null!=e.parent&&(this.selectedStringMenuParents.push(e.parent.headerContent),console.log(e.parent),this.getParents(e.parent))},prevPage(){this.isDoneLoading2=!1,this.pageLeft-=2,this.pageRight-=2,this.isLastPage=!1},nextPage(){this.isDoneLoading2=!1,this.pageLeft+=2,this.pageRight+=2},clearPopup(){this.hasSelectedString=!1},handlerFunction(e){if(e.preventDefault(),console.log("length: ",window.getSelection().toString(),window.getSelection().toString().length,this.hasSelectedString),window.getSelection().toString()!=this.selectedString&&(this.hasSelectedString=!1),window.getSelection().toString().length>0&&1==this.hasSelectedString)return;let t=/^[a-z0-9]$/i;if((1!=window.getSelection().toString().length||t.test(window.getSelection().toString()))&&(this.hasSelectedString=!1,window.getSelection().toString().length>0)){this.hasSelectedString=!0;encodeURIComponent(window.getSelection().toString()).replace(/[!'()*]/g,escape);this.selectedString=window.getSelection().toString();var n=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;const t=e.clientX,o=e.clientY+20+n;this.posX=t,this.posY=o}},showPopup(){console.log(this.pageLeft),this.selectedStringMenuParents=[],this.tableContentsArr.forEach((e=>{console.log(e),e.fromPage<=this.pageLeft&&e.toPage>=this.pageLeft&&(this.selectedStringMenuParents=[e.headerContent],this.getParents(e),console.log("set content table at ",e))})),0===this.selectedStringMenuParents.length&&this.selectedStringMenuParents.push("Không có mục lục"),$("#fire-modal").click()},clickModal(){this.$refs.copyBtn.innerHTML="Sao chép",this.$refs.copyBtn.style.backgroundColor="#6777ef"},doExtractInfo(){console.log("data",this.selectedStringMenuParents);var e="";for(let o=0;o<this.selectedStringMenuParents.length;o++)e+=this.selectedStringMenuParents[o]+"/ ";const t='"'+this.selectedString+'"\nTrang '+("LEFT"==this.pagePosition?this.pageLeft:this.pageRight)+" - Mục: "+e.substring(0,e.length-2)+" - Sách: "+this.book.name+" - Tác giả: "+this.book.author+" - Xuất bản: "+this.book.publisher+" ("+this.book.publishedYear+")",n=document.createElement("textarea");n.value=t,this.$refs.reference.appendChild(n),n.select(),n.setSelectionRange(0,99999),document.execCommand("copy"),this.$refs.reference.removeChild(n),this.$refs.copyBtn.innerHTML="Đã sao chép",this.$refs.copyBtn.style.backgroundColor="green"},selectOnPage(e){this.pagePosition=e},handlePasswordRequest(e,t){e(prompt(t?"Enter password again":"Enter password"))},handleDocumentRender(){this.isDoneLoading=!0,this.isDoneLoading2=!0,this.pageRight==this.pageCount&&(this.isLastPage=!0);let e=1e3;this.currentTableContentArray=[],this.tableContentsArr.forEach((t=>{t.fromPage<=this.pageRight&&this.pageRight<=t.toPage&&(this.currentTableContentArray.push(t),t.toPage-t.fromPage<=e&&(e=t.toPage-t.fromPage,this.currentTableContent=t.headerContent))}))}}};const ze=(0,ue.Z)(Le,[["render",ce],["__scopeId","data-v-38aa20d9"]]);var De=ze}}]);
//# sourceMappingURL=851.64af328e.js.map